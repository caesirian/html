<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>HG Dashboard Profesional</title>
<!-- Chart.js CDN -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  /* Diseño azul oscuro profesional HG */
  body {
    margin: 0;
    font-family: Arial, sans-serif;
    background-color: #0d1b2a;
    color: #ffffff;
  }
  header {
    background-color: #1b2a41;
    padding: 15px 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 18px;
    font-weight: bold;
  }
  nav {
    width: 220px;
    background-color: #1b2a41;
    position: fixed;
    top: 60px;
    bottom: 0;
    padding-top: 20px;
  }
  nav a {
    display: block;
    padding: 12px 20px;
    color: #ffffff;
    text-decoration: none;
    font-weight: 500;
  }
  nav a:hover {
    background-color: #162036;
  }
  main {
    margin-left: 240px;
    padding: 20px;
  }
  section {
    margin-bottom: 40px;
  }
  h2 {
    border-bottom: 2px solid #162036;
    padding-bottom: 5px;
    margin-bottom: 15px;
    color: #00bcd4;
  }
  canvas {
    background-color: #162036;
    border-radius: 8px;
    padding: 10px;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 10px;
    background-color: #1b2a41;
  }
  table th, table td {
    border: 1px solid #0d1b2a;
    padding: 8px;
    text-align: left;
  }
  table th {
    background-color: #162036;
  }
</style>
</head>
<body>

<header>
  HG Dashboard Profesional
  <div id="cache-status">Cache: cargando...</div>
</header>

<nav>
  <a href="#finanzas">Finanzas</a>
  <a href="#ventas">Ventas</a>
  <a href="#caja">Caja Movimientos</a>
  <a href="#pendientes">Cuentas Pendientes</a>
</nav>

<main>

<section id="finanzas">
  <h2>Finanzas Mensuales</h2>
  <canvas id="chartFinanzas"></canvas>
</section>

<section id="ventas">
  <h2>Ventas Mensuales</h2>
  <canvas id="chartVentas"></canvas>
</section>

<section id="caja">
  <h2>Caja Movimientos</h2>
  <canvas id="chartCaja"></canvas>
</section>

<section id="pendientes">
  <h2>Cuentas Pendientes</h2>
  <table id="tablaPendientes">
    <thead>
      <tr>
        <th>Cliente/Proveedor</th>
        <th>Categoría</th>
        <th>Subcategoría</th>
        <th>Monto</th>
        <th>Fecha</th>
      </tr>
    </thead>
    <tbody>
    </tbody>
  </table>
</section>

<script>
// === Conexión GAS ===
const GAS_URL = "https://script.google.com/macros/s/AKfycbyTLrGiqes1VOp8E51Kq91P7YihPKNtN1f0f6u2JitXOteGyGrNXqiSjdXYJ8HAtfs/exec";

async function fetchData() {
  try {
    const res = await fetch(GAS_URL);
    const data = await res.json();
    document.getElementById('cache-status').innerText = 'Cache: OK';
    return data;
  } catch (err) {
    console.error("Error fetch GAS:", err);
    document.getElementById('cache-status').innerText = 'Cache: ERROR';
    return null;
  }
}

// === Funciones de gráficos ===
function crearGraficoBarras(ctx, labels, data, label, color) {
  return new Chart(ctx, {
    type: 'bar',
    data: {
      labels,
      datasets: [{
        label,
        data,
        backgroundColor: color,
        borderColor: '#00bcd4',
        borderWidth: 1
      }]
    },
    options: {
      responsive: true,
      scales: { y: { beginAtZero: true } }
    }
  });
}

function crearGraficoLineas(ctx, labels, data, label, color) {
  return new Chart(ctx, {
    type: 'line',
    data: {
      labels,
      datasets: [{
        label,
        data,
        borderColor: color,
        backgroundColor: 'rgba(0,188,212,0.2)',
        tension: 0.2
      }]
    },
    options: { responsive: true }
  });
}

function actualizarTablaPendientes(tablaId, datos) {
  const tbody = document.querySelector(`#${tablaId} tbody`);
  tbody.innerHTML = '';
  datos.forEach(row => {
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${row["Cliente/Proveedor"]}</td>
      <td>${row.Categoría}</td>
      <td>${row["Subcategoría"]}</td>
      <td>${parseFloat(row.Monto).toLocaleString("es-AR", {style:"currency", currency:"ARS"})}</td>
      <td>${row.Fecha}</td>
    `;
    tbody.appendChild(tr);
  });
}

// === Renderizar todo ===
async function initDashboard() {
  const data = await fetchData();
  if (!data) return;

  // Finanzas Mensuales
  const finanzas = data["Finanzas_Mensual"] || [];
  const labelsFinanzas = finanzas.map(f => f.Mes);
  const valoresFinanzas = finanzas.map(f => parseFloat(f.Total || 0));
  crearGraficoLineas(document.getElementById('chartFinanzas'), labelsFinanzas, valoresFinanzas, 'Saldo Mensual', '#00bcd4');

  // Ventas Mensuales
  const ventas = data["Ventas_Mensual"] || [];
  const labelsVentas = ventas.map(v => v.Mes);
  const valoresVentas = ventas.map(v => parseFloat(v.Total || 0));
  crearGraficoBarras(document.getElementById('chartVentas'), labelsVentas, valoresVentas, 'Ventas', '#00bcd4');

  // Caja Movimientos
  const caja = data["Caja_Movimientos"] || [];
  const labelsCaja = caja.map(c => c.Fecha);
  const valoresCaja = caja.map(c => parseFloat(c.Monto || 0));
  crearGraficoBarras(document.getElementById('chartCaja'), labelsCaja, valoresCaja, 'Movimientos Caja', '#00bcd4');

  // Cuentas Pendientes
  const pendientes = data["Cuentas_Pendientes"] || [];
  actualizarTablaPendientes('tablaPendientes', pendientes);
}

// Inicializar
initDashboard();
</script>

</body>
</html>
